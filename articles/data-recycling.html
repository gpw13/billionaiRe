<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="billionaiRe">
<title>Data recycling â€¢ billionaiRe</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Data recycling">
<meta property="og:description" content="billionaiRe">
<meta property="og:image" content="/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">billionaiRe</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.8.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../articles/index.html">Articles</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/gpw13/billionaiRe/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Data recycling</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/gpw13/billionaiRe/blob/HEAD/vignettes/data-recycling.Rmd" class="external-link"><code>vignettes/data-recycling.Rmd</code></a></small>
      <div class="d-none name"><code>data-recycling.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The data pipeline of the Triple Billion store multiple data sets
corresponding to different stages of transformation before combining
them for the final calculations. This enables a flexible approach where
one scenario can be reused by others to fill in the gaps. For more
information on the scenarios see the <a href="scenarios.html">scenarios</a> vignette.</p>
<p>As stated in the scenario definition, scenarios should contain
<strong>all</strong> and <strong>only</strong> the data that is strictly
needed for calculations with billionaiRe. In order to have accurate
Triple Billion calculations, it is then necessary to <strong>recycle the
data</strong> to recombine different datasets into single timeseries
that then can be used in the calculations. .If a scenario does not
contain the required data, the functions will fail.</p>
<p>billionaiRe <code>transform_</code> and <code>calculate_</code>
functions (as well as <a href="https://gpw13.github.io/rapporteur/" class="external-link">rapporteur</a> export
functions) use the <code>scenario</code> column as a
<code>dplyr::group()</code> in <a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">dplyr::group_by</a>.If
a scenario does not contain the required data, the functions will
fail.</p>
<p>For most users of billionaiRe, accessing external data tables (on
xMart or World Health Data Hub) is more resource intensive than
computation. This means that large tables should be avoided. Recycling
the data between scenarios is then key to avoid storing identical data
multiple times that will then be used by different scenarios. This is
what data recycling aims to achieve: <em>minimal storage before
computation</em>.</p>
<p>Data recycling infers the existence of a reference scenario. This
reference scenario is called <code>default</code> by default, and it is
a parameter (<code>default_scenario</code>) of
<code><a href="../reference/recycle_data.html">recycle_data()</a></code> and all functions that rely on full data
sets. The name of <code>default_scenario</code> can then be modified as
required.</p>
<p><code>default</code> scenario provides values when they are absent
from scenarios, along with:</p>
<ul>
<li>
<code>scenario_reported_estimated</code> for reported/estimated
values (<code>routine</code> by default),</li>
<li>
<code>scenario_reference_infilling</code> for values
imputed/projected by technical programs
(<code>reference_infilling</code> by default)</li>
<li>and <code>scenario_covid_shock</code> for COVID-19 shock
values.</li>
</ul>
<p>Together <code>scenario_reported_estimated</code>,
<code>scenario_reference_infilling</code>, and
<code>scenario_covid_shock</code> are the base scenarios.</p>
<p>Data recycling works by adding to all scenarios present in the
<code>scenario_col</code> column values that are missing from first
<code>default_scenario</code>, then looks in
<code>scenario_reported_estimated</code>,
<code>scenario_reported_estimated</code> and
<code>scenario_covid_shock</code> to add values that are not present in
the scenario, nor any of the preceding scenarios. This is done through a
series of <a href="https://dplyr.tidyverse.org/reference/filter-joins.html" class="external-link">dplyr::anti_join</a>:</p>
</div>
<div class="section level2">
<h2 id="implementation-of-data-recycling-in-billionaire">Implementation of data recycling in billionaiRe<a class="anchor" aria-label="anchor" href="#implementation-of-data-recycling-in-billionaire"></a>
</h2>
<p>Data recycling is implemented in billionaiRe through the
<code><a href="../reference/recycle_data.html">recycle_data()</a></code> function. This function wraps around
<code><a href="../reference/recycle_data.html">recycle_data_scenario_single()</a></code> (not exported for external
use) to run the recycling over all the scenarios present in the input
data frame.</p>
<p><code>recycle_data</code> uses similar parameters than other exported
billionaiRe functions. However it introduces specific parameters:</p>
<ul>
<li>
<code>default_scenario</code>: sets the default parameter (see
above). <code>default</code> by default</li>
<li>
<code>scenario_reported_estimated</code>: sets the
reported/estimated scenario (see above). <code>routine</code> by
default</li>
<li>
<code>scenario_reference_infilling</code>: sets the
projected/imputed scenarios. <code>reference_infilling</code> by
default.</li>
<li>
<code>scenario_covid_shock</code>: sets the data that correspond to
the COVID-19 shock. <code>covid_shock</code> by default.</li>
<li>
<code>include_projection</code>: Boolean to set if projections
should be included in the recycling. <code>TRUE</code> by default.</li>
<li>
<code>recycle_campaigns</code>: Boolean to set if campaign data
should be included in the recycling. <code>TRUE</code> by default.</li>
</ul>
<p>A <code>recycle</code> and <code>...</code>parameters were added to
the <code>transform_</code> functions to ease recycling. If
<code>recycle</code> is <code>TRUE</code>, data will be recycled, using
the eventual parameters passed through the <code>...</code>.</p>
<p>In order to facilitate the cleaning of data, a <code>recycled</code>
column is added by the recycling function to identify data points that
have been recycled. They can then be removed by the
<code><a href="../reference/remove_recycled_data.html">remove_recycled_data()</a></code> function that takes into account a
few specific scenarios.</p>
<p>To avoid adding ellipses to all billionaiRe functions which could
have opened a number of unforeseeable issues, not all formally recycled
data can be identified and thus removed with
<code><a href="../reference/remove_recycled_data.html">remove_recycled_data()</a></code>, especially for the HEP billion.
This includes mostly carried over campaign data.</p>
<p>A <code><a href="../reference/recycle_data.html">make_default_scenario()</a></code> function is provided to
combine the <code>default_scenario</code>,
<code>scenario_reported_estimated</code>,
<code>scenario_reference_infilling</code> and
<code>scenario_covid_shock</code> efficiently.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Seth Caldwell, Alice Robson, Nelly Biondi, Elliott Messeiller, Muhammad Jarir Kanji.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
