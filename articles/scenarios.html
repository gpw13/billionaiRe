<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="billionaiRe">
<title>Scenarios • billionaiRe</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Scenarios">
<meta property="og:description" content="billionaiRe">
<meta property="og:image" content="/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">billionaiRe</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.6.7</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/hep.html">HEP Billion Calculation</a>
    <a class="dropdown-item" href="../articles/hpop.html">HPOP Billion calculation</a>
    <a class="dropdown-item" href="../articles/scenarios.html">Scenarios</a>
    <a class="dropdown-item" href="../articles/uhc.html">UHC Billion calculation</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/gpw13/billionaiRe/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Scenarios</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/gpw13/billionaiRe/blob/HEAD/vignettes/scenarios.Rmd" class="external-link"><code>vignettes/scenarios.Rmd</code></a></small>
      <div class="d-none name"><code>scenarios.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="definition">Definition<a class="anchor" aria-label="anchor" href="#definition"></a>
</h2>
<p>In the Triple Billions and the billionaiRe package context, <code>scenarios</code> are understood as alternative, plausible, description of how the future may develop based on a set of defined assumptions.</p>
<p>Three sets of scenarios can be identified:</p>
<ul>
<li>Event-based scenarios: an event has a presumed but yet unknown impact on the Billions (e.g. COVID-19 scenarios). This type of scenario usually starts from the last reported value, but the scenarios could provide their own values points for any part of the time series.</li>
<li>Trajectory-based scenarios: certain targets or trajectories must be reached by a certain date (e.g. Sustainable Development Goal targets, or acceleration scenarios from technical programs). Those scenarios should start from 2019 as 2018 is the GPW13 baseline year.</li>
<li>Internal use scenarios: scenarios provide the ability to deal with alternative time series of any kind, which could be include alternative projection methods, update to data sources, etc. While those scenarios might not be displayed for public use, they illustrate the versatility seeking in scenarios.</li>
</ul>
<p>Scenarios must:</p>
<ol style="list-style-type: decimal">
<li>Be <a href="https://r4ds.had.co.nz/tidy-data.html" class="external-link">tidy</a>: each row is a unique combination of iso3 country-code, year, indicator, and scenario (if relevant).</li>
<li>Contain <strong>all</strong> and <strong>only</strong> the data that is strictly needed for calculations with billionaiRe</li>
</ol>
<ul>
<li>If billionaiRe require data that is missing in the scenario, they will be recycled from other scenarios (see <a href="#data-recycling">Data recycling</a>).</li>
</ul>
<p>There are three special case scenario:</p>
<ul>
<li>
<code>none</code>: stores the <code>reported</code> and <code>estimated</code> data</li>
<li>
<code>tp</code>: stores WHO technical programs projected data (either <code>projected</code> or <code>imputed</code>).</li>
<li>
<code>default</code>: stores the main scenario presented on the dashboard. It can include projections and imputations. It is also the scenario to be used for data recycling (see <a href="#data-recycling">Data recycling</a>)</li>
</ul>
</div>
<div class="section level2">
<h2 id="data-recycling">Data recycling<a class="anchor" aria-label="anchor" href="#data-recycling"></a>
</h2>
<p>billionaiRe <code>transform_</code> and <code>calculate_</code> functions (as well as rapporteur export functions) use the provided scenario column as a group in <a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">dplyr::group_by</a>. Scenarios should then contain all the required data needed for billionaiRe calculations. If a scenario does not contain the required data, the functions will fail.</p>
<p>For most users of billionaiRe, accessing external data tables (on xMart or Wolrd Health Data Hub) is more resource intensive than computation. This means that large tables should be avoided. Recycling the data between scenarios is then key to avoid storing identical data multiple times that will then be used by different scenarios. This is what data recycling aims to achieve: minimal storage before computation.</p>
<p>Data recycling infers the existence of a reference scenario, which is be the main scenario displayed on the dashboard. The default scenario is call <code>default</code> by default, but as this is a parameter (<code>default_scenario</code>) of <code><a href="../reference/recycle_data.html">recycle_data()</a></code>, it can be modified as required. <code>default</code> scenario provides values when they are absent from scenarios, along with <code>scenario_reported_estimated</code> for reported/estimated values (<code>none</code> by default) and <code>scenario_tp</code> for values imputed/projected by technical programs (<code>tp</code> by default).</p>
<p>Data recycling works by adding to all scenarios present in the <code>scenario</code> column values that are missing from first <code>default_scenario</code>, then looks in <code>scenario_reported_estimated</code> and <code>scenario_reported_estimated</code> to add values that are not present in the scenario, nor any of the preceding scenarios. This is done through a series of <a href="https://dplyr.tidyverse.org/reference/filter-joins.html" class="external-link">dplyr::anti_join</a>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.who.int/data/triple-billion-dashboard" class="external-link">billionaiRe</a></span><span class="op">)</span>

<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_misc_data.html">load_misc_data</a></span><span class="op">(</span><span class="st">"test_data/test_data/test_data_2022-01-20T14-13-10.parquet"</span><span class="op">)</span>

<span class="va">scenario_df</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">scenario</span> <span class="op">==</span> <span class="st">"covid_dip_lag"</span><span class="op">)</span>

<span class="va">default_not_in_scenario</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">scenario</span> <span class="op">==</span> <span class="st">"default"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html" class="external-link">anti_join</a></span><span class="op">(</span><span class="va">scenario_df</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"iso3"</span>, <span class="st">"ind"</span>, <span class="st">"year"</span><span class="op">)</span><span class="op">)</span>

<span class="va">reported_not_in_scenario</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">scenario</span> <span class="op">==</span> <span class="st">"none"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html" class="external-link">anti_join</a></span><span class="op">(</span><span class="va">scenario_df</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"iso3"</span>, <span class="st">"ind"</span>, <span class="st">"year"</span><span class="op">)</span><span class="op">)</span>

<span class="va">reported_not_in_default</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html" class="external-link">anti_join</a></span><span class="op">(</span><span class="va">reported_not_in_scenario</span>, <span class="va">default_not_in_scenario</span>,
  by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"iso3"</span>, <span class="st">"ind"</span>, <span class="st">"year"</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">tp_not_in_scenario</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">scenario</span> <span class="op">==</span> <span class="st">"tp"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html" class="external-link">anti_join</a></span><span class="op">(</span><span class="va">scenario_df</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"iso3"</span>, <span class="st">"ind"</span>, <span class="st">"year"</span><span class="op">)</span><span class="op">)</span>

<span class="va">tp_not_in_default</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html" class="external-link">anti_join</a></span><span class="op">(</span><span class="va">tp_not_in_scenario</span>, <span class="va">default_not_in_scenario</span>,
  by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"iso3"</span>, <span class="st">"ind"</span>, <span class="st">"year"</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">not_in_scenario</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">default_not_in_scenario</span>, <span class="va">reported_not_in_default</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">tp_not_in_default</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>recycled <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>As for projections, the track change offered by git will act as a history of what is contained in the default scenario at any given time. It could be interesting to have a log of what is meant by <code>default</code> at any given time in the future to make the retrieval of the history easier.</p>
<div class="section level3">
<h3 id="implementation-of-data-recycling-in-billionaire">Implementation of data recycling in billionaiRe<a class="anchor" aria-label="anchor" href="#implementation-of-data-recycling-in-billionaire"></a>
</h3>
<p>Data recycling is implemented in billionaiRe through the <code><a href="../reference/recycle_data.html">recycle_data()</a></code> function. This function wraps around <code><a href="../reference/recycle_data_scenario_single.html">recycle_data_scenario_single()</a></code> (not exported for public use) to run the recycling over all the scenarios present in the input data frame.</p>
<p><code>recycle_data</code> uses similar parameters than other exported billionaiRe functions. However it introduces specific parameters:</p>
<ul>
<li>
<code>default_scenario</code>: sets the default parameter (see above). <code>default</code> by default</li>
<li>
<code>scenario_reported_estimated</code>: sets the reported/estimated scenario (see above). <code>none</code> by default</li>
<li>
<code>scenario_tp</code>: sets the projected/imputed scenarios. <code>tp</code> by default.</li>
<li>
<code>include_projection</code>: Boolean to set if projections should be included in the recycling. <code>TRUE</code> by default.</li>
<li>
<code>recycle_campaigns</code>: Boolean to set if campaign data should be included in the recycling. <code>TRUE</code> by default.</li>
</ul>
<p>A <code>recycle</code> and <code>...</code>parameters were added to the <code>transform_</code> functions to ease recycling. If <code>recycle</code> is <code>TRUE</code>, data will be recycled, using the eventual parameters passed through the <code>...</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># Adding a detect_respond raw to avoid warning from recycle_data.</span>
<span class="va">detect_respond_afg_2018</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>
  iso3 <span class="op">=</span> <span class="st">"AFG"</span>,
  ind <span class="op">=</span> <span class="st">"detect_respond"</span>,
  value <span class="op">=</span> <span class="fl">46.66667</span>,
  scenario <span class="op">=</span> <span class="st">"none"</span>,
  type <span class="op">=</span> <span class="st">"estimated"</span><span class="op">)</span>

<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_misc_data.html">load_misc_data</a></span><span class="op">(</span><span class="st">"test_data/test_data/test_data_2022-01-20T14-13-10.parquet"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">detect_respond_afg_2018</span><span class="op">)</span>

<span class="va">test_data_hep</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/recycle_data.html">recycle_data</a></span><span class="op">(</span>billion <span class="op">=</span> <span class="st">"hep"</span>, include_projection <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/transform_hep_data.html">transform_hep_data</a></span><span class="op">(</span>scenario <span class="op">=</span> <span class="st">"scenario"</span><span class="op">)</span>

<span class="co"># Exactly equivalent to above:</span>
<span class="va">test_data_hep_transform</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/transform_hep_data.html">transform_hep_data</a></span><span class="op">(</span>scenario <span class="op">=</span> <span class="st">"scenario"</span>, recycle <span class="op">=</span> <span class="cn">TRUE</span>, include_projection <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/setops.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="va">test_data_hep</span>, <span class="va">test_data_hep_transform</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 0 × 9</span></span>
<span class="co">#&gt; <span style="color: #949494;"># … with 9 variables: iso3 &lt;chr&gt;, year &lt;dbl&gt;, ind &lt;chr&gt;, scenario &lt;chr&gt;,</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   value &lt;dbl&gt;, type &lt;chr&gt;, recycled &lt;lgl&gt;, source &lt;chr&gt;,</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   transform_value &lt;dbl&gt;</span></span>

<span class="va">test_data_hpop</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/recycle_data.html">recycle_data</a></span><span class="op">(</span><span class="st">"hpop"</span>, include_projection <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="co"># Exactly equivalent to above:</span>
<span class="va">test_data_hpop_transform</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/transform_hpop_data.html">transform_hpop_data</a></span><span class="op">(</span>recycle <span class="op">=</span> <span class="cn">TRUE</span>, include_projection <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/setops.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="va">test_data_hep</span>, <span class="va">test_data_hep_transform</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 0 × 9</span></span>
<span class="co">#&gt; <span style="color: #949494;"># … with 9 variables: iso3 &lt;chr&gt;, year &lt;dbl&gt;, ind &lt;chr&gt;, scenario &lt;chr&gt;,</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   value &lt;dbl&gt;, type &lt;chr&gt;, recycled &lt;lgl&gt;, source &lt;chr&gt;,</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   transform_value &lt;dbl&gt;</span></span></code></pre></div>
<p>In order to facilitate the cleaning of data, a <code>recycled</code> column is added by the recycling function to identify data points that have been recycled. They can then be removed by the <code><a href="../reference/remove_recycled_data.html">remove_recycled_data()</a></code> function that takes into account a few specific scenarios.</p>
<p>To avoid adding ellipses to all billionaiRe functions which could have opened a number of unforeseeable issues, not all formally recycled data can be identified and thus removed with <code><a href="../reference/remove_recycled_data.html">remove_recycled_data()</a></code>, especially for the HEP billion. This includes mostly carried over campaign data.</p>
<p>A <code><a href="../reference/make_default_scenario.html">make_default_scenario()</a></code> function is provided to combine the <code>default_scenario</code>, <code>scenario_reported_estimated</code>, and <code>scenario_tp</code> efficiently.</p>
</div>
</div>
<div class="section level2">
<h2 id="scenarios-integration-into-data-pipeline">Scenarios integration into data pipeline<a class="anchor" aria-label="anchor" href="#scenarios-integration-into-data-pipeline"></a>
</h2>
<p>The current GPW13 data pipeline is composed of four main steps:</p>
<ol style="list-style-type: decimal">
<li>Ingestion</li>
<li>Projecting</li>
<li>Calculating</li>
<li>Exporting</li>
</ol>
<p>The integration of the scenario happens at stage 3 (Calculating), as does the rest of the billionaiRe calculations.</p>
<p>Within the billionaiRe calculations pipeline, adding the scenarios values should ideally be the first steps. However, some scenarios, especially event-based and trajectory-based scenarios, might require some level of data recycling before they are run. If this is the case, errors should be produced when user try to run them.</p>
<p>In the <code><a href="../reference/add_scenario.html">add_scenario()</a></code> function, a <code>default_scenario</code> argument can be passed to provide a specific default_scenario.</p>
<p>The <code>add_scenario</code> functions is built on a range of pre-defined set of scenarios calculation functions that are called within the add_scenario function. There is then two layers of scenario functions that can be called :</p>
<ol style="list-style-type: decimal">
<li>
<strong>base scenario functions</strong>: they are the building blocs of the wrapper functions. For instance, <code>scenario_fixed_target</code> sets the values on a linear trajectory towards a target by a certain year, <code>scenario_percent_baseline</code> sets a progression from the baseline with a fix percentage increase.</li>
<li>
<strong>wrappers functions</strong> combine base scenario functions to generate more complex scenarios like <code>acceleration</code>, <code>sdg</code>, etc.</li>
</ol>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.who.int/data/triple-billion-dashboard" class="external-link">billionaiRe</a></span><span class="op">)</span>

<span class="va">test_hep</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/add_scenario.html">add_scenario</a></span><span class="op">(</span>
    scenario_function <span class="op">=</span> <span class="st">"halt_rise"</span>, <span class="co"># picks from a pre-determined list of scenarios</span>
    scenario <span class="op">=</span> <span class="st">"scenario"</span>,
    default_scenario <span class="op">=</span> <span class="st">"covid_dip_lag"</span>
  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="co"># indicates the scenario used as the default (in addition to `none` and `tp`, where relevant).</span>
  <span class="fu"><a href="../reference/add_scenario.html">add_scenario</a></span><span class="op">(</span>
    scenario_function <span class="op">=</span> <span class="st">"percent_baseline"</span>, <span class="co"># picks from a pre-determined list of scenarios</span>
    percent_change <span class="op">=</span> <span class="fl">10</span>,
    scenario <span class="op">=</span> <span class="st">"scenario"</span>,
    default_scenario <span class="op">=</span> <span class="st">"covid_dip_lag"</span>
  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="co"># indicates the scenario used as the default (in addition to `none` and `tp`, where relevant)</span>
  <span class="fu"><a href="../reference/recycle_data.html">recycle_data</a></span><span class="op">(</span>
    billion <span class="op">=</span> <span class="st">"hep"</span>, <span class="co"># One function for each billions, so need to specify which one this is applied to.</span>
    scenario <span class="op">=</span> <span class="st">"scenario"</span>,
    default_scenario <span class="op">=</span> <span class="st">"covid_dip_lag"</span>,
    scenario_reported_estimated <span class="op">=</span> <span class="st">"none"</span>,
    scenario_tp <span class="op">=</span> <span class="st">"tp"</span>,
    include_projection <span class="op">=</span> <span class="cn">TRUE</span>,
    recycle_campaigns <span class="op">=</span> <span class="cn">TRUE</span>
  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="co"># Warnings come from the call to recycle as Afghanistan as in 2018 values for detect_respond. Thus, all scenarios return NAs for Afghanistan for that year as they all require a 2018 value.</span>
  <span class="fu"><a href="../reference/transform_hep_data.html">transform_hep_data</a></span><span class="op">(</span>
    scenario <span class="op">=</span> <span class="st">"scenario"</span>,
    recycle <span class="op">=</span> <span class="cn">FALSE</span>
  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="co"># adds a parameter to `transform_` functions to recycle. In this pipeline it is redundant as data was already recycled.</span>
  <span class="fu"><a href="../reference/calculate_hep_components.html">calculate_hep_components</a></span><span class="op">(</span>scenario <span class="op">=</span> <span class="st">"scenario"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/calculate_hep_billion.html">calculate_hep_billion</a></span><span class="op">(</span>scenario <span class="op">=</span> <span class="st">"scenario"</span>, end_year <span class="op">=</span> <span class="fl">2025</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span>
    <span class="va">ind</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>
      <span class="st">"prevent"</span>,
      <span class="st">"espar"</span>,
      <span class="st">"detect_respond"</span>,
      <span class="st">"hep_idx"</span>
    <span class="op">)</span>,
    <span class="va">year</span> <span class="op">==</span> <span class="fl">2025</span>
  <span class="op">)</span>
<span class="co">#&gt; Warning: detect_respond must be present in df for at least the start_year and end_year, for each country (and scenario when provided)</span>
<span class="co">#&gt;       Missing values in AFG:</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 4</span></span>
<span class="co">#&gt; <span style="color: #949494;"># Groups:   iso3, year, scenario [1]</span></span>
<span class="co">#&gt;   iso3   year ind            scenario </span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> AFG    <span style="text-decoration: underline;">2</span>025 detect_respond halt_rise</span>
<span class="co">#&gt; Warning: detect_respond must be present in df for at least the start_year and end_year, for each country (and scenario when provided)</span>
<span class="co">#&gt;       Missing values in AFG:</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 4</span></span>
<span class="co">#&gt; <span style="color: #949494;"># Groups:   iso3, year, scenario [1]</span></span>
<span class="co">#&gt;   iso3   year ind            scenario</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> AFG    <span style="text-decoration: underline;">2</span>025 detect_respond 10_2018</span>
<span class="co">#&gt; Warning: detect_respond must be present in df for at least the start_year and end_year, for each country (and scenario when provided)</span>
<span class="co">#&gt;       Missing values in AFG:</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 4</span></span>
<span class="co">#&gt; <span style="color: #949494;"># Groups:   iso3, year, scenario [2]</span></span>
<span class="co">#&gt;   iso3   year ind            scenario </span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> AFG    <span style="text-decoration: underline;">2</span>025 detect_respond halt_rise</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> AFG    <span style="text-decoration: underline;">2</span>025 detect_respond 10_2018</span></code></pre></div>
<div class="section level3">
<h3 id="base-scenario-functions">Base scenario functions:<a class="anchor" aria-label="anchor" href="#base-scenario-functions"></a>
</h3>
<ul>
<li>
<code>scenario_aroc</code>: sets the values on the annual rate of change (AROC) from the data. Three cases of AROC are possible:
<ul>
<li>
<code>target</code>: aims at a specific <code>target_value</code> by <code>target_year</code>
</li>
<li>
<code>latest</code>: takes the AROC between <code>baseline_year</code> and the previous year</li>
<li>
<code>percent_change</code>: applies <code>percent_change</code> for the AROC from <code>baseline_year</code>.</li>
</ul>
</li>
<li>
<code>scenario_halt_rise</code>: stops the rise of the indicator</li>
<li>
<code>scenario_percent_baseline</code>: change by a fixed percentage from a baseline value by target year. Done in percentage of value and not percentage points.</li>
<li>
<code>scenario_linear_change</code>: change by a fixed percentage point from a baseline value by target year. Done in percentage points.</li>
<li>
<code>scenario_linear_change_col</code>: change by a fixed percentage point from a baseline value by target year, with the percentage change value provided in a column and not as a a single value. This allow for instance to have a different change for every country, indicator and year combinationss. Done in percentage points.</li>
<li>
<code>scenario_quantile</code>: aims at a change in value based on the quantile’s AROC.</li>
<li>
<code>scenario_best_in_region</code>: aims at the AROC of the best country in the region.</li>
<li>
<code>scenario_fixed_target</code>: aims at a fixed target (e.g. 90, 5, etc.)</li>
<li>
<code>scenario_fixed_target_col</code>: aims at a fixed target provided in a column.</li>
</ul>
<p>Each of those functions use their own parameters.</p>
<p>In order to have clean scenarios, a series of parameters are passed to the functions to run properly:</p>
<ul>
<li>
<code>small_is_best</code>: if TRUE, a lower value is considered as a better public health outcome (e.g. adult obesity)</li>
<li>
<code>trim_values</code>: if TRUE, values will be trimed around:
<ul>
<li>
<code>keep_better_values</code>: if TRUE, if values before running the scenario are better than after, the original values will be kept.</li>
<li>
<code>upper_limit</code>, <code>lower_limit</code>: if <code>trim</code> is TRUE, values above the upper_limit will have upper_limit and values below lower_limit will hasve lower_limit.</li>
<li>
<code>trim_year</code>: if TRUE values before <code>start_year</code> and after <code>end_year</code> will be removed.</li>
</ul>
</li>
</ul>
</div>
<div class="section level3">
<h3 id="wrappers-functions">Wrappers functions:<a class="anchor" aria-label="anchor" href="#wrappers-functions"></a>
</h3>
<p>Currently there are three wrapper functions implemented:</p>
<ul>
<li>
<code>add_scenario</code> that wraps around any of the scenarios in its <code>scenario_function</code> parameter</li>
<li>
<code>acceleration</code> that implements the acceleration scenarios defined in coordination with WHO technical programs.</li>
<li>
<code>sdg</code> that implements acceleration scenarios to reach sustainable development goals.</li>
</ul>
<p>Each of the base scenario is wrapped in <code>add_scenario</code>. This function calls a <code>add_</code> function for each indicator in the data frame. This allows to apply the same base scenario to all indicators in the data frame, while passing indicator specific defaults:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.who.int/data/triple-billion-dashboard" class="external-link">billionaiRe</a></span><span class="op">)</span>

<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>
  value <span class="op">=</span> <span class="fl">80</span><span class="op">:</span><span class="fl">100</span>,
  year <span class="op">=</span> <span class="fl">2010</span><span class="op">:</span><span class="fl">2030</span>,
  ind <span class="op">=</span> <span class="st">"adult_obese"</span>,
  iso3 <span class="op">=</span> <span class="st">"testalia"</span>,
  scenario <span class="op">=</span> <span class="st">"default"</span>
<span class="op">)</span>

<span class="fu"><a href="../reference/add_scenario.html">add_scenario</a></span><span class="op">(</span><span class="va">df</span>, scenario_function <span class="op">=</span> <span class="st">"halt_rise"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">scenario</span> <span class="op">==</span> <span class="st">"halt_rise"</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 × 5</span></span>
<span class="co">#&gt;   value  year ind         iso3     scenario </span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;glue&gt;</span>   </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span>    88  <span style="text-decoration: underline;">2</span>018 adult_obese testalia halt_rise</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span>    88  <span style="text-decoration: underline;">2</span>019 adult_obese testalia halt_rise</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span>    88  <span style="text-decoration: underline;">2</span>020 adult_obese testalia halt_rise</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span>    88  <span style="text-decoration: underline;">2</span>021 adult_obese testalia halt_rise</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">5</span>    88  <span style="text-decoration: underline;">2</span>022 adult_obese testalia halt_rise</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">6</span>    88  <span style="text-decoration: underline;">2</span>023 adult_obese testalia halt_rise</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">7</span>    88  <span style="text-decoration: underline;">2</span>024 adult_obese testalia halt_rise</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">8</span>    88  <span style="text-decoration: underline;">2</span>025 adult_obese testalia halt_rise</span></code></pre></div>
<p>Behind the scenes, <code>add_scenario</code> first get all unique indicators present in <code>df</code>, then passed each of them to <code><a href="../reference/add_scenario_indicator.html">add_scenario_indicator()</a></code>. <code><a href="../reference/add_scenario_indicator.html">add_scenario_indicator()</a></code> then find the <code>add_scenario_adult_obese</code> function and runs it with <code>df</code> and <code>halt_rise</code>. <code>add_scenario_adult_obese</code> then passes appropriate parameters to <code>scenario_halt_rise</code>. In this case, this is mostly to pass <code>small_is_best</code> to the scenario function.</p>
<p>The <code>...</code> ellipsis is used to based down parameters down the functions.</p>
<div class="section level4">
<h4 id="acceleration-scenarios">Acceleration scenarios<a class="anchor" aria-label="anchor" href="#acceleration-scenarios"></a>
</h4>
<p>Acceleration scenarios are a special case scenario that wraps different base scenario for each indicator. This is to take into consideration the specific cases of each indicator and what accelerating means for each of each individually. They can then be called directly from <code>add_scenario</code> or through indicator level function following the <code>accelerate_{indicator}</code> naming convention.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="scenarios-naming-convention">Scenarios naming convention<a class="anchor" aria-label="anchor" href="#scenarios-naming-convention"></a>
</h2>
<ul>
<li><p><a href="https://en.wikipedia.org/wiki/Snake_case" class="external-link">Lower Snake case</a> is used</p></li>
<li><p>Short and very descriptive names: use verbs as much as possible</p></li>
<li><p>Use only commonly understood acronyms and abbreviations</p></li>
<li>
<p><code>event</code> scenarios start with them. E.g. covid, pre_covid_bau</p>
<ul>
<li>Sub-event scenarios should have a descriptive word rather than numbering or other undefined markers. <strong>DO</strong>: covid_never_return. <strong>DON’T</strong>: COVID_1</li>
</ul>
</li>
<li><p><code>none</code> is reserved for reported/estimated data</p></li>
<li><p><code>default</code> is reserved for the main data present on the dashboard</p></li>
<li><p><code>acceleration</code> is reserved for acceleration scenarios / trajectories</p></li>
<li><p><code>sdg</code> is reserved for sustainable development goals</p></li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Seth Caldwell, Alice Robson, Nelly Biondi, Elliott Messeiller, Muhammad Jarir Kanji.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
